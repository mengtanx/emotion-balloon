# 情绪气球 - Emotion Balloon

一个帮助用户记录、释放和管理情绪的互动式Web应用。通过AI对话和气球释放的象征性仪式，为用户提供情绪出口和心理支持。

## 📋 功能特性

### 🎈 情绪释放
- **情绪选择**：支持多种预设情绪类型（快乐、悲伤、焦虑、愤怒等）
- **AI对话**：与智能AI进行情绪交流，获得理解和建议
- **气球释放**：通过美丽的气球动画象征性地释放情绪负担
- **自定义情绪**：用户可以添加和管理自己的情绪类型

### 📅 情绪记录
- **日历视图**：直观的月历界面显示所有情绪记录
- **多记录支持**：同一天可以记录多次不同情绪
- **颜色编码**：不同情绪类型用不同颜色标识
- **智能显示**：
  - 单个记录：显示一个颜色小点
  - 多个记录：显示多个颜色小点（最多4个）
  - 超过4个：显示数量标记（如 +2）
- **悬停提示**：鼠标悬停显示详细情绪信息
- **历史补记**：支持为过去日期添加情绪记录

### 📊 数据统计
- **总对话数**：统计所有情绪对话记录
- **记录天数**：统计有记录的唯一天数  
- **释放数量**：统计已释放的气球数量
- **实时更新**：数据自动同步，确保准确性

### 🔄 数据管理
- **自动刷新**：页面焦点变化时自动更新数据
- **手动刷新**：提供手动刷新按钮
- **本地存储**：所有数据保存在浏览器本地
- **数据持久化**：关闭浏览器后数据不会丢失

## 🛠 技术栈

- **前端框架**：Next.js 15 (App Router)
- **UI组件**：React, Shadcn UI, Radix UI
- **样式**：Tailwind CSS
- **动画**：Framer Motion
- **AI集成**：OpenAI API (GPT模型)
- **数据存储**：LocalStorage
- **开发语言**：TypeScript

## 🚀 快速开始

### 安装依赖
\`\`\`bash
npm install --legacy-peer-deps
\`\`\`

### 环境配置
创建 `.env.local` 文件并添加OpenAI API密钥：
\`\`\`bash
OPENAI_API_KEY=your_openai_api_key_here
\`\`\`

### 启动开发服务器
\`\`\`bash
npm run dev
\`\`\`

访问 http://localhost:3000 开始使用应用。

### 构建生产版本
\`\`\`bash
npm run build
npm start
\`\`\`

## 🎯 使用指南

### 记录情绪
1. 点击"开始释放情绪"或"记录情绪"
2. 选择当前感受的情绪类型
3. 描述你的情绪状态和原因
4. 与AI进行对话交流
5. 完成对话后选择"释放气球"

### 查看记录
1. 进入"情绪记录"页面
2. 在日历上查看不同日期的情绪标记
3. 点击日期查看详细对话记录
4. 使用统计数据了解情绪模式

### 多记录管理
- **同日多记录**：一天内可以记录多次不同情绪
- **历史补记**：点击过去日期可以补记当时的情绪
- **视觉区分**：不同情绪用不同颜色小点表示
- **记录上限显示**：超过4个记录会显示数量提示

## 🔧 最近更新

### v2.1.3 - 日历日期重复Bug修复 (2025-05-29)
- 🐛 **严重Bug修复**：修复日历组件显示重复日期格子的问题（如3月显示多个1号、2号、3号）
- 🔧 **日期计算逻辑重构**：完全修正了`getMonthDates`函数中上个月和下个月的日期计算错误
- ✅ **跨年处理优化**：正确处理12月到1月、1月到12月的跨年日期计算
- 🧪 **专项测试脚本**：新增`test-calendar-date-fix.js`自动化测试脚本验证修复效果
- 📋 **测试指南完善**：更新测试文档包含日期重复Bug的详细测试步骤

### 技术修复详情
- 修正 `new Date(year, month - 1, 0)` 为 `new Date(year, month, 0)` 获取正确的上个月最后一天
- 添加跨年边界处理：`month === 0 ? year - 1 : year` 和 `month === 11 ? year + 1 : year`
- 确保日期计算的连续性和唯一性，消除重复显示问题
- 所有月份（包括2月、31天月份、30天月份）的日历显示现在完全正确

### v2.1.2 - 日期显示一致性修复 (2025-05-29)
- 🐛 **重复显示修复**：修复情绪记录同时显示在多个日期格子的问题
- 🐛 **日期选择修复**：修复点击日历日期与侧边栏显示日期不一致的Bug
- 🔧 **时区处理优化**：创建统一的日期工具函数，避免时区转换导致的日期偏移
- ✅ **数据一致性**：确保日历组件、记录页面、释放页面使用统一的日期处理逻辑
- 🧪 **测试完善**：添加专门的日期显示Bug测试脚本和详细测试指南

### 技术修复详情
- 新增 `lib/date-utils.ts` 统一日期处理工具
- 使用 `formatDateToLocal()` 避免 `toISOString()` 的时区问题
- 重构日历组件的日期计算逻辑，使用 `getMonthDates()` 函数
- 统一所有组件的日期字符串格式为 `YYYY-MM-DD`

### v2.1.1 - 过去日期显示Bug修复 (2025-05-29)
- 🐛 **关键Bug修复**：修复过去日期情绪记录不在日历上显示的问题
- 🔧 **数据结构统一**：修正记录页面数据格式与日历组件期望格式的不匹配
- ✅ **显示一致性**：确保所有日期的情绪记录都能正确显示颜色标记
- 🧪 **测试完善**：添加专门的过去日期显示测试脚本和指南

### 技术修复详情
- 修改 `refreshEmotionRecords` 函数使用 `emotions` 数组而非单个 `emotion` 字段
- 确保数据结构与 `AppleCalendar` 组件期望的格式完全一致
- 移除冗余的 `hasMultiple` 字段，简化数据结构

### v2.1.0 - 多情绪记录支持 (2025-05-28)
- ✅ **多记录显示**：支持同一天显示多个情绪记录
- ✅ **颜色小点**：每个情绪记录对应一个颜色小点
- ✅ **过去补记**：支持为过去日期添加情绪记录
- ✅ **智能提示**：悬停显示记录数量和情绪类型
- ✅ **数据刷新**：修复气球释放后记录消失的问题
- ✅ **性能优化**：使用useMemo优化统计计算
- ✅ **自动更新**：页面焦点变化时自动刷新数据
- ✅ **手动刷新**：添加手动刷新按钮
- ✅ **Suspense修复**：解决useSearchParams的构建问题

### 技术改进
- 重构日历组件数据结构
- 优化情绪记录的存储和显示逻辑
- 改进用户交互体验
- 增强数据同步机制

## 📝 完整更新日志

### v1.5.0 (2025-05-29) 🎨🔧💬

**💬 AI对话体验革命性升级**

- 新增Markdown渲染支持：AI回复现在完美支持分段、要点、格式化等Markdown语法
- 安装react-markdown和remark-gfm库，实现GitHub风格的Markdown渲染
- 对话页面和侧边栏中AI消息均支持富文本显示，用户消息保持纯文本
- AI分段建议现在能正确显示为分段和要点，大幅提升可读性

**🎨 首页布局重大优化**

- 重新设计首页结构：将"释放你的情绪"主要内容上移到欢迎动画后
- 情绪历史热力图移至页面底部，形成更清晰的信息层次
- 优化动画时序：各模块按逻辑顺序依次出现，提升用户体验
- 强化核心功能展示：用户现在首先看到功能介绍，最后查看历史记录

**📊 热力图365天完整显示修复**

- 完全重构日期计算算法：修复只显示到1月份的Bug，现在显示完整365天
- 智能周对齐：热力图正确从周日开始，完美符合GitHub Contributions风格
- 月份标签动态定位：基于实际周数据位置精确显示12个月标签
- 空格子优雅处理：正确处理边缘日期，确保网格完整性
- 基准日期固定：使用2025-05-28作为固定基准，确保一致的365天显示

**🐛 关键Bug修复**

- 修复日历日期选择Bug：用户点击日历日期后记录情绪，现在正确保存到选择的日期而非今天
- 添加URL参数传递：侧边栏"开始记录情绪"按钮现在会传递选择的日期
- 释放页面日期读取：新增useSearchParams读取URL中的date参数
- 日期提示界面：当用户选择特定日期时，显示友好的日期提示信息

**🔧 技术架构增强**

- 依赖管理优化：使用--legacy-peer-deps解决react-day-picker的date-fns版本冲突
- TypeScript类型完善：为所有新增的Markdown组件添加完整类型支持
- 代码结构优化：分离用户消息和AI消息的渲染逻辑
- 性能优化：Markdown渲染仅对AI消息生效，避免不必要的处理开销

**🎯 用户体验全面提升**

- AI回复格式化显示：专业建议现在以清晰的分段和要点形式展现
- 日期选择体验：用户现在可以准确为任意日期记录情绪，而不会错误保存到今天
- 热力图交互完善：365天完整显示让用户能看到完整的情绪历史趋势
- 布局逻辑优化：首页信息层次更清晰，引导用户从了解功能到查看历史记录

**📱 跨平台兼容性**

- Markdown渲染在移动端和桌面端均完美显示
- 热力图在小屏幕设备上支持横向滚动
- 日期选择功能在触摸设备上也能精确工作
- 所有新功能保持响应式设计原则

### v1.4.0 (2025-05-28) 🧠💬

**🧠 AI提示词专业化升级**

- 优化AI回复分段和格式化：增加适当分段分要点，提升回复可读性
- 完善认知行为疗法(CBT)指导原则：更详细的十种认知扭曲识别框架
- 强化苏格拉底式提问方法：通过温和提问引导用户自我发现
- 改进现实检验策略：帮助用户客观审视想法和感受
- 优化语言表达：使用更温暖、非评判的专业语调

**💬 用户体验细节优化**

- AI回复字数控制优化：从150-250字调整为250字以内，给予更充分表达空间
- 加强回复结构化：AI现在会自动分段分要点，让专业建议更易读易懂
- 提升对话连贯性：更好地结合对话历史提供个性化回应
- 优化错误处理：改进API异常时的降级响应机制

**🎯 心理支持质量提升**

- 基于《伯恩斯新情绪疗法》的更深度应用
- 区分事实与想法的引导更加精准
- 积极思维替代策略更加具体可操作
- 必要时推荐专业心理健康服务的判断更准确

### v1.3.0 (2025-05-28) 🎈✨

**🎈 气球动画全面重构**

- 完全重写气球飞行动画，修复动画不生效的问题
- 真实椭圆形气球设计，添加气球线绳和高光效果
- 优化飞行轨迹：从屏幕底部准确飞向顶部，轻微摇摆模拟真实飞行
- 增强爆炸特效：径向渐变爆炸效果配合闪光特效
- 升级粒子系统：15个多彩粒子随机散射，增强视觉冲击
- 完整释放仪式：动画结束显示成功图标和鼓励文字

**📊 GitHub风格热力图重设计**

- 采用标准GitHub Contributions样式：52周×7天网格布局
- 紧凑设计：3×3像素方块，减少UI占用空间
- 智能颜色映射：9种情绪色彩的4级强度梯度显示
- 月份和周标签优化：顶部月份标签，底部周一/三/五标签
- 今日高亮：蓝色边框标记当前日期
- 悬停交互：鼠标悬停时颜色加深，显示详细tooltip

**🔧 技术架构优化**

- 解决CSS循环依赖编译错误，移除 `@apply`循环引用
- 改用内联样式实现动态颜色，提升性能和稳定性
- 添加径向渐变CSS支持气球爆炸特效
- 优化热力图颜色计算逻辑，支持RGB颜色值映射

**🎯 用户体验提升**

- 首页热力图模块更加紧凑美观，减少视觉负担
- 气球释放动画更加流畅自然，增强情绪释放的仪式感
- 保持所有交互功能的同时优化视觉效果
- 修复开发环境编译问题，提升开发体验

### v1.2.0 (2025-05-28) 🎉

**🎈 气球释放体验升级**

- 新增气球飞向空中并爆炸的完整动画序列
- 添加粒子特效和视觉反馈，增强释放仪式感
- 完善释放完成后的感谢和鼓励界面

**📊 情绪历史可视化**

- 在首页新增GitHub风格的情绪热力图
- 365天情绪记录一目了然
- 支持悬停查看详细信息和趋势分析

**🧠 AI心理支持专业化**

- 基于《伯恩斯新情绪疗法》重写AI提示词
- 采用认知行为疗法(CBT)的专业方法
- 提供更科学的情绪引导和支持

**🔧 交互体验优化**

- 修复侧边栏"开始记录情绪"按钮无响应问题
- 完善释放完成后的操作流程
- 增加重新开始和查看记录的快捷入口

### v1.1.0 (2025-05-28)

**🎨 界面优化**

- 优化情绪气球颜色配置，解决焦虑和困惑颜色相似问题
- 焦虑：改为黄褐色到黄色渐变 (`from-amber-400 to-yellow-600`)
- 困惑：改为靛蓝色到灰石色渐变 (`from-indigo-400 to-slate-600`)

**⚡ 性能提升**

- 升级AI模型从DeepSeek Chat v3切换到Google Gemini 2.0 Flash
- 显著提升AI响应速度和质量
- 优化流式响应处理机制

**🔧 技术改进**

- 更新OpenRouter API配置
- 完善环境变量配置说明
- 优化错误处理和降级机制

**📚 文档更新**

- 增加详细的API密钥配置指南
- 完善部署和开发说明
- 更新技术栈信息

## 🧪 测试
运行测试指南查看功能验证：
\`\`\`bash
cat test-emotion-record.md
\`\`\`

### 演示数据
如需创建演示数据来测试多记录功能，在浏览器控制台运行：
\`\`\`javascript
// 复制 create-demo-data.js 中的内容到控制台执行
\`\`\`

## 📁 项目结构

\`\`\`
├── app/                    # Next.js App Router页面
│   ├── page.tsx           # 主页 - 应用介绍和快速入口
│   ├── release/           # 情绪释放页面
│   ├── records/           # 情绪记录页面  
│   ├── about/             # 关于页面
│   └── api/               # API路由
├── components/            # React组件
│   ├── ui/               # 基础UI组件
│   │   ├── apple-calendar.tsx      # 日历组件
│   │   ├── emotion-heatmap.tsx     # 情绪热力图
│   │   └── ...           # 其他UI组件
│   ├── emotion-detail-sidebar.tsx  # 情绪详情侧边栏
│   └── custom-emotion-manager.tsx  # 自定义情绪管理
├── lib/                   # 工具库
│   └── emotion-utils.ts   # 情绪数据管理工具
└── public/               # 静态资源
\`\`\`

## 🎨 设计理念

### 用户体验
- **情感化设计**：温暖的色彩和流畅的动画
- **直观交互**：简单易懂的操作流程
- **视觉反馈**：清晰的状态指示和进度提示
- **响应式设计**：适配各种设备尺寸

### 功能设计
- **情绪出口**：提供安全的情绪表达空间
- **AI陪伴**：智能对话给予理解和支持
- **仪式感**：气球释放增加情绪处理的仪式感
- **记录追踪**：帮助用户了解情绪模式和变化

## 🔮 未来计划

- [ ] 情绪趋势分析图表
- [ ] 导出情绪记录数据
- [ ] 情绪提醒和建议功能
- [ ] 社区分享（匿名）
- [ ] 移动端应用
- [ ] 更多情绪类型和自定义选项

## 📄 许可证

本项目采用 MIT 许可证。详情请查看 [LICENSE](LICENSE) 文件。

## 🤝 贡献

欢迎提交 Issues 和 Pull Requests 来改进这个项目！

---

*让每一次情绪都被温柔以待* 🎈💙
